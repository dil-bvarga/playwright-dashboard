<div class="title-container">
  <h3 class="sub-title">Latest test suite run results</h3>
  <mat-form-field class="filter-select" [formGroup]="lastRunCountForm">
    <mat-label>Filter</mat-label>
    <mat-select formControlName="filter" disableRipple>
      <mat-option value="">None</mat-option>
      <mat-option value="flaky">Show Flaky tests</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field class="last-run-count-select" [formGroup]="lastRunCountForm">
    <mat-label>Last run count</mat-label>
    <mat-select formControlName="lastRunCount" disableRipple>
      <mat-option value="7">7</mat-option>
      <mat-option value="15">15</mat-option>
      <mat-option value="30">30</mat-option>
    </mat-select>
  </mat-form-field>
</div>

<mat-spinner
  class="spinner"
  *ngIf="isLoading$.asObservable() | async"
></mat-spinner>

<mat-accordion multi #accordion="matAccordion">
  <mat-expansion-panel
    class="expansion-panel"
    *ngFor="let suite of filteredTestResults$ | async"
    (click)="clickOnSuite($event)"
  >
    <mat-expansion-panel-header class="expansion-header">
      <mat-panel-title>
        <div class="panel-title">
          <mat-icon
            class="folder-icon"
            aria-hidden="true"
            fontIcon="folder"
          ></mat-icon>
          <div>
            <p class="suite-title">{{ suite.suiteTitle }}</p>
            <p class="latest-suite-run-time">
              {{ suite | latestSuiteRunTime }} minutes ago
            </p>
          </div>
        </div>
      </mat-panel-title>
    </mat-expansion-panel-header>

    <div
      class="test-result-container"
      *ngFor="let test of suite.specs; trackBy: testTitle"
    >
      <div class="test-title-container">
        <p class="test-title">{{ test.title }}</p>
        <p class="test-line">{{ test.file }}:{{ test.line }}</p>
      </div>

      <div class="test-runs-column-container">
        <div
          *ngFor="
            let testRun of test.runs | slice : 0 : 50;
            trackBy: testRunSpecId
          "
        >
          <div
            class="test-run-rectangle"
            [ngClass]="{
              expected: testRun.tests | allExpectedTestRuns,
              skipped: testRun.tests | hasSkippedTestRuns,
              unexpected: testRun.tests | hasUnexpectedTestRuns,
              flaky: testRun.tests | hasFlakyTestRuns
            }"
            #tooltip="matTooltip"
            [matTooltip]="testRun.suiteRunStartTime | date : 'medium'"
            [matTooltipPosition]="'above'"
            matTooltipHideDelay="100"
          ></div>
        </div>
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>
